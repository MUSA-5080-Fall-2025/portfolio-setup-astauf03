st_transform (2272)
st_crs(roads)
ep_buff <- st_buffer(ep_boundary, dist = 1000)
roads_clipped <- st_intersection(roads, ep_buff)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid.major = element_line(color = "gray90", size = 0.3),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid.major = element_line(color = "gray90", size = 0.3),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "blanchedalmond")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "blanchedalmond")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ep_buff <- st_buffer(ep_boundary, dist = 800) #800 ft buffer
roads_clipped <- st_intersection(roads, ep_buff)
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .8) +
geom_sf(data = bl_ep_active, aes(color = "Business Licenses"), size = 2, alpha = 0.7) +
geom_sf(data = plcb_ep, aes(color = "PLCB Liquor Licenses"), size = 2, alpha = 0.7) +
scale_color_manual(values = c("Business Licenses" = "#1B9E77",
"PLCB Liquor Licenses" = "#D95F02")) +
labs(title = "Business and Liquor Licenses in East Passyunk", color = "License Type") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
View(plcb_ep)
View(plcb_active)
View(bl_ep_active)
View(bl_ep_active_tidy)
# Find business licenses that are at/near PLCB locations
bl_with_plcb <- st_join(bl_ep_active, plcb_active, join = st_nearest_feature)
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_with_plcb, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
View(bl_with_plcb)
View(plcb_sf)
View(plcb_sf)
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_with, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_with_plcb, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
bl_nightlife <- bl_ep_active %>%
filter(category %in% c("Food/Beverage", "Entertainment"))
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
stat_density_2d(data = bl_nightlife %>%
mutate(x = st_coordinates(.)[,1],
y = st_coordinates(.)[,2]),
aes(x = x, y = y, fill = after_stat(level)),
geom = "polygon", alpha = 0.6, bins = 10) +
scale_fill_viridis_c(option = "rocket") +
labs(title = "Nightlife License Density in East Passyunk",
fill = "Density") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
stat_density_2d_filled(data = bl_nightlife %>%
mutate(x = st_coordinates(.)[,1],
y = st_coordinates(.)[,2]),
aes(x = x, y = y),
alpha = 0.6, bins = 8, contour_var = "count") +
geom_sf(data = bl_nightlife, size = 1, alpha = 0.5, color = "black") +  # add points back
scale_fill_viridis_d(option = "plasma") +
labs(title = "Nightlife License Density in East Passyunk",
fill = "Count") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
stat_density_2d_filled(data = bl_nightlife %>%
mutate(x = st_coordinates(.)[,1],
y = st_coordinates(.)[,2]),
aes(x = x, y = y),
alpha = 0.6, bins = 10, contour_var = "count") +
geom_sf(data = bl_nightlife, size = 1, alpha = 0.5, color = "black") +  # add points back
scale_fill_viridis_d(option = "plasma") +
labs(title = "Nightlife License Density in East Passyunk",
fill = "Count") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
stat_density_2d_filled(data = bl_nightlife %>%
mutate(x = st_coordinates(.)[,1],
y = st_coordinates(.)[,2]),
aes(x = x, y = y),
alpha = 0.6, bins = 40, contour_var = "count") +
geom_sf(data = bl_nightlife, size = 1, alpha = 0.5, color = "black") +  # add points back
scale_fill_viridis_d(option = "plasma") +
labs(title = "Nightlife License Density in East Passyunk",
fill = "Count") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
View(bl_with_plcb)
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_ep_active, aes(color = licensetype), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = ep_boundary, fill = NA, color = "black") +
geom_hex(data = bl_with_plcb %>%
mutate(x = st_coordinates(.)[,1], y = st_coordinates(.)[,2]),
aes(x = x, y = y), bins = 15) +
scale_fill_viridis_c() +
labs(title = "License Distribution", fill = "Count")
# Find business licenses that are at/near PLCB locations
bl_with_plcb <- st_intersects(bl_ep_active, plcb_active, join = st_nearest_feature())
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_with_plcb, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
# Find business licenses that are at/near PLCB locations
bl_with_plcb <- st_join(bl_ep_active, plcb_active, join = st_intersects())
# Find business licenses that are at/near PLCB locations
bl_with_plcb <- st_join(bl_ep_active, plcb_active, join = st_intersects)
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = .7) +
geom_sf(data = bl_with_plcb, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
# Find which BL are within 50 feet of PLCB
nearby <- st_is_within_distance(bl_ep_active, plcb_active, dist = 50)
# Filter BL that have nearby PLCB
bl_near_plcb <- bl_ep_active[lengths(nearby) > 0, ]
# How many overlap?
nrow(bl_near_plcb)
# Join - finds nearest PLCB for each BL
bl_with_plcb <- st_join(bl_ep_active, plcb_active, join = st_nearest_feature)
# Look at the joined data
bl_with_plcb %>%
st_drop_geometry() %>%
select(business_name, licensetype, License.Type) %>%
filter(!is.na(License.Type))  # only show where PLCB exists nearby
ggplot() +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
geom_sf(data = bl_ep_active, color = "blue", size = 2, alpha = 0.5) +
geom_sf(data = plcb_active, color = "red", size = 2, alpha = 0.5) +
labs(title = "Spatial Overlap: Business Licenses (blue) vs PLCB (red)") +
theme_minimal()
# First, make sure both have clean address columns
bl_ep_active <- bl_ep_active %>%
mutate(address_clean = toupper(trimws(address)))
plcb_active <- plcb_active %>%
mutate(address_clean = toupper(trimws(premise_address)))  # or whatever the PLCB address column is called
# First, make sure both have clean address columns
bl_ep_active <- bl_ep_active %>%
mutate(address_clean = toupper(trimws(address)))
plcb_active <- plcb_active %>%
mutate(address_clean = toupper(trimws(Premises.Adress)))  # or whatever the PLCB address column is called
# First, make sure both have clean address columns
bl_ep_active <- bl_ep_active %>%
mutate(address_clean = toupper(trimws(address)))
plcb_active <- plcb_active %>%
mutate(address_clean = toupper(trimws(Premises.Address)))  # or whatever the PLCB address column is called
# Then join by address
combined <- bl_ep_active %>%
st_drop_geometry() %>%  # drop geometry for the join
inner_join(plcb_active %>% st_drop_geometry(),
by = "address_clean",
suffix = c("_bl", "_plcb"))
# See results
combined %>%
select(address_clean, licensetype, License.Type)
nrow(combined)
library(stringr)
plcb_active <- plcb_active %>%
mutate(License.Type_clean = str_remove(License.Type, ", PHILADELPHIA, PA \\d{5}.*$"))
# Check the cleaned version
table(plcb_active$License.Type_clean)
plcb_active <- plcb_active %>%
mutate(Premises.Address_clean = str_remove(Premises.Address, ", PHILADELPHIA, PA \\d{5}.*$"))
# Check the cleaned version
table(plcb_active$Premises.Address_clean)
head(plcb_active$Premises.Address, 10)
head(bl_ep_active$address, 10)
head(plcb_active$Premises.Address, 10)
head(bl_ep_active$address, 10)
head(bl_ep_active$address, 10)
plcb_active <- plcb_active %>%
mutate(address_clean = str_remove(Premises.Address, ", PHILADELPHIA PA.*$") %>%
toupper() %>%
trimws())
plcb_active <- plcb_active %>%
mutate(address_clean = str_remove(Premises.Address, ", PHILADELPHIA PA.*$") %>%
toupper() %>%
trimws())
combined <- bl_ep_active %>%
st_drop_geometry() %>%
inner_join(plcb_active %>% st_drop_geometry(),
by = "address_clean",
suffix = c("_bl", "_plcb"))
bl_ep_active <- bl_ep_active %>%
mutate(address_clean = toupper(trimws(address)))
combined <- bl_ep_active %>%
st_drop_geometry() %>%
inner_join(plcb_active %>% st_drop_geometry(),
by = "address_clean",
suffix = c("_bl", "_plcb"))
nrow(combined)
combined %>%
select(address_clean, licensetype, License.Type)
View(combined)
ggplot() +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
geom_sf(data =combined, aes(color = legalname) color = "blue", size = 2, alpha = 0.5) +
ggplot() +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
geom_sf(data =combined, aes(color = legalname), size = 2, alpha = 0.5) +
labs(title = "Spatial Overlap: Business Licenses (blue) vs PLCB (red)") +
theme_minimal()
combined %>%
summarize(
total_overlap = n(),
unique_addresses = n_distinct(address_clean)
)
combined_sf <- bl_ep_active %>%
filter(address_clean %in% combined$address_clean)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
geom_sf(data = bl_ep_active, aes(color = "Business License Only"), size = 3, alpha = 0.5) +
geom_sf(data = plcb_active, aes(color = "Liquor License Only"), size = 3, alpha = 0.5) +
geom_sf(data = combined_sf, aes(color = "Both Licenses"), size = 3) +
scale_color_manual(values = c("Business License Only" = "#7FC97F",
"Liquor License Only" = "#FDC086",
"Both Licenses" = "#E41A1C")) +
labs(title = "License Distribution in East Passyunk", color = "License Type") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
combined_sf <- bl_ep_active %>%
filter(address_clean %in% combined$address_clean)
ggplot() +
geom_sf(data = roads_clipped, color = "gray80", size = 0.2) +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
geom_sf(data = bl_ep_active, aes(color = "Business License Only"), size = 3, alpha = 0.5) +
geom_sf(data = plcb_active, aes(color = "Liquor License Only"), size = 3, alpha = 0.5) +
geom_sf(data = combined_sf, aes(color = "Both Licenses"), size = 3) +
scale_color_manual(values = c("Business License Only" = "#7FC97F",
"Liquor License Only" = "#FDC086",
"Both Licenses" = "#9748D9")) +
labs(title = "License Distribution in East Passyunk", color = "License Type") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
combined_spatial <- st_join(bl_ep_active,
plcb_active,
join = st_is_within_distance,
dist = 25) %>%
filter(!is.na(License.Type))
View(combined_spatial)
ggplot() +
geom_sf(data = ep_boundary, fill = NA, color = "black", size = 1) +
geom_sf(data = combined_spatial, aes(color = licensetype) , size = 2, alpha = 0.5) +
labs(title = "Spatial Overlap: Business Licenses (blue) vs PLCB (red)") +
theme_minimal()
ggplot() +
geom_sf(data = ep_boundary, fill = "lightgray", alpha = 0.3) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +  # Your licenses
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
ggplot() +
geom_sf(data = roads_clipped, color = "gray54", size = 0.2) +
geom_sf(data = ep_boundary, fill = "lightgray", alpha = 0.3) +
geom_sf(data = bl_ep_active, aes(color = category), size = 2) +
scale_color_brewer(palette = "Dark2") +
labs(title = "Active Licenses in East Passyunk", color = "Category") +
theme_minimal() +
theme(
panel.grid = element_blank(),
axis.text = element_blank(),
axis.title = element_blank(),
axis.ticks = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.background = element_rect(color = "black", size = 0.5, fill = "white")
)
setwd("C:/Users/astau/OneDrive - PennO365/MUSA_5080_PPA/portfolio-setup-astauf03")
